<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The Notes - Events & Announcements</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header style="padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee;">
        <a href="index.html" class="nav-button" style="text-decoration:none;">‚Üê Back</a>
        <h2 style="margin:0; font-family:inherit;">The Notes</h2>
        <button id="adminToggle" class="nav-button" style="font-size:12px;">Add Post</button>
    </header>

    <main style="max-width:800px; margin:40px auto; padding:0 20px;">
        <!-- Admin Panel (hidden by default) -->
        <section id="adminPanel" class="admin-panel" style="display:none; margin-bottom:40px;">
            <h3>Post an Announcement</h3>
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventTitle">Title</label>
                    <input type="text" id="eventTitle" placeholder="Event or announcement title" required>
                </div>
                <div class="form-group">
                    <label for="eventDate">Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label for="eventDesc">Description</label>
                    <textarea id="eventDesc" placeholder="Details..." required></textarea>
                </div>
                <button type="submit" class="buy-button">Post</button>
            </form>
        </section>

        <!-- Events Feed -->
        <section id="eventsFeed" class="events-feed">
            <!-- Events will be populated here by JS -->
        </section>
    </main>

    <script>
        // No events yet - waiting for backend posts
        let events = JSON.parse(localStorage.getItem('villagerEvents')) || [];

        const adminPanel = document.getElementById('adminPanel');
        const adminToggle = document.getElementById('adminToggle');
        const eventForm = document.getElementById('eventForm');
        const eventsFeed = document.getElementById('eventsFeed');

        // Toggle admin panel
        adminToggle.addEventListener('click', () => {
            adminPanel.style.display = adminPanel.style.display === 'none' ? 'block' : 'none';
        });

        // Render events
        function renderEvents() {
            eventsFeed.innerHTML = '';
            if (events.length === 0) {
                eventsFeed.innerHTML = '<div class="empty-state"><p>No posts yet</p></div>';
                return;
            }
            events.sort((a, b) => new Date(a.date) - new Date(b.date));
            events.forEach(event => {
                const card = document.createElement('article');
                card.className = 'event-card';
                const dateObj = new Date(event.date);
                const dateStr = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                card.innerHTML = `
                    <div class="event-date">${dateStr}</div>
                    <h3 class="event-title">${event.title}</h3>
                    <p class="event-desc">${event.description}</p>
                    <button class="event-delete" data-id="${event.id}">Delete</button>
                `;
                eventsFeed.appendChild(card);
            });
            // Add delete listeners
            document.querySelectorAll('.event-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    events = events.filter(ev => ev.id !== id);
                    localStorage.setItem('villagerEvents', JSON.stringify(events));
                    renderEvents();
                });
            });
        }

        // Post new event
        eventForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const desc = document.getElementById('eventDesc').value;
            const newEvent = {
                id: Date.now(),
                title,
                date,
                description: desc
            };
            events.push(newEvent);
            localStorage.setItem('villagerEvents', JSON.stringify(events));
            eventForm.reset();
            renderEvents();
        });

        // Initial render
        renderEvents();
    </script>
</body>
</html>
